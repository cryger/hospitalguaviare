<h2 class="gov-title">Gestión de PQRSF</h2>

<!-- FILTROS -->
<div class="pqrsf-filtros">
  <button
    class="gov-tab"
    [class.active]="filtroEstado === 'Todas'"
    (click)="filtroEstado = 'Todas'">
    Todas
  </button>

  <button
    class="gov-tab warning"
    [class.active]="filtroEstado === 'Pendientes'"
    (click)="filtroEstado = 'Pendientes'">
    Pendientes
  </button>

  <button
    class="gov-tab success"
    [class.active]="filtroEstado === 'Respondidas'"
    (click)="filtroEstado = 'Respondidas'">
    Respondidas
  </button>
</div>

<!-- TABLA -->
<div class="gov-table-wrapper">
  <table class="gov-table">
    <thead>
      <tr>
        <th>Tipo</th>
        <th>Ciudadano</th>
        <th>Fecha</th>
        <th>Estado</th>
        <th class="acciones">Acción</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of pqrsfFiltradas">
        <td>{{ p.tipo }}</td>
        <td>{{ p.nombre }}</td>
        <td>{{ p.fechaCreacion | date:'mediumDate' }}</td>

        <td>
          <span
            class="estado"
            [class.pendiente]="p.estado !== 'Respondida'"
            [class.respondida]="p.estado === 'Respondida'">
            {{ p.estado }}
          </span>
        </td>

        <td class="acciones">
          <button
            class="gov-btn-secondary"
            (click)="verDetalle(p)">
            Ver / Responder
          </button>
        </td>
      </tr>

      <tr *ngIf="pqrsfFiltradas.length === 0">
        <td colspan="5" class="sin-datos">
          No hay PQRSF para este filtro
        </td>
      </tr>
    </tbody>
  </table>
</div>


<!--MOdal-->

<!-- =========================
     MODAL VER / RESPONDER PQRSF
========================= -->
<div class="gov-modal-backdrop" *ngIf="modalPQRSFOpen">

  <div class="gov-modal gov-modal-lg" role="dialog" aria-modal="true">

    <!-- HEADER -->
    <header class="gov-modal-header">
      <div>
        <h3>Detalle de PQRSF</h3>
        <p class="gov-modal-subtitle">
          Información enviada por el ciudadano
        </p>
      </div>

      <button
        type="button"
        class="gov-modal-close"
        aria-label="Cerrar"
        (click)="cerrarModalPQRSF()">
        ✕
      </button>
    </header>

    <!-- BODY -->
    <section class="gov-modal-body">

      <!-- INFO CIUDADANO -->
      <div class="pqrsf-info">
        <div><strong>Tipo:</strong> {{ seleccionado?.tipo }}</div>
        <div><strong>Ciudadano:</strong> {{ seleccionado?.nombre }}</div>
        <div><strong>Correo:</strong> {{ seleccionado?.correo }}</div>
        <div><strong>Fecha:</strong> {{ seleccionado?.fechaCreacion | date }}</div>
      </div>

      <!-- MENSAJE -->
      <div class="pqrsf-mensaje">
        <label>Mensaje del ciudadano</label>
        <div class="mensaje-box">
          {{ seleccionado?.mensaje }}
        </div>
      </div>

      <!-- RESPUESTA -->
      <form
        [formGroup]="formRespuesta"
        (ngSubmit)="responderPQRSF()"
        class="gov-form">

        <div class="gov-field">
          <label for="respuesta">Respuesta institucional</label>
          <textarea
            id="respuesta"
            rows="5"
            formControlName="respuesta"
            placeholder="Escriba la respuesta oficial al ciudadano">
          </textarea>
        </div>

        <!-- ACCIONES -->
        <footer class="gov-modal-actions">
          <button
            type="button"
            class="gov-btn-secondary"
            (click)="cerrarModalPQRSF()">
            Cancelar
          </button>

          <button
            type="submit"
            class="gov-btn-primary"
            [disabled]="formRespuesta.invalid">
            Enviar respuesta
          </button>
        </footer>

      </form>

    </section>

  </div>
</div>
